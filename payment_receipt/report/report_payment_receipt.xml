<odoo>
  <template id="account_report_payment_receipt_document_page" inherit_id="account.report_payment_receipt_document">
    <xpath expr="//div[@class='page']" position="replace">
      <!-- <t t-call="web.external_layout"> -->
<!--    <t t-set="o" t-value="o.with_context(lang=lang)"/>
        <t t-set="xml" t-value="o.l10n_mx_edi_get_xml_etree()"/>
        <t t-set="tfd" t-value="o.l10n_mx_edi_get_tfd_etree(xml)"/> -->
      <div class="page">
        <t t-set="pago" t-value="o.complemento_pago(xml)" />
        <table border="1" style="width:100%; border: 2px solid;">
            <tr>
              <td style="width:50%; border: 2px solid;">
                <strong>CLIENTE:</strong><br/><br/>
                <span t-field="o.partner_id.name"/> <br/>
                <span t-field="o.partner_id.street_name"/>, <br/>
                Estado de <span t-field="o.partner_id.state_id"/>, <span t-field="o.partner_id.country_id"/>, 
                CP: <span t-field="o.partner_id.zip"/>  <br/>
                RFC: <span t-field="o.partner_id.vat"/>
              </td>
              <td style="width:50%; border: 2px solid;">
                <strong>Uso CFDI: </strong>[<span t-esc="xml.Receptor.get('UsoCFDI', '')"/>] Por definir<br/>
                <strong>Tipo de Comprobante: </strong>[<span t-esc="xml.get('TipoDeComprobante')"/>] Pago<br/>
                <strong>Versión de Comprobante: </strong><span t-esc="xml.get('Version')"/><br/>
                <strong>No. CSD del Emisor: </strong><span t-esc="xml.get('NoCertificado')"/><br/>
                <strong>No. CSD del SAT: </strong><span t-esc="tfd.get('NoCertificadoSAT')"/><br/>
                <strong>Forma de Pago: </strong>[<span t-esc="pago.get('forma_de_pago_p')"/>] <span t-field="o.l10n_mx_edi_payment_method_id"/><br/>
              </td>
            </tr>
        </table>
        <br/>
        <br/>
        <table class="table table-sm">
            <thead>
                <tr style="border-bottom: solid;">
                  <th><span>Folio Fiscal</span></th>
                  <th><span>Serie</span></th>
                  <th><span>Folio</span></th>
                  <th><span>Moneda Factura</span></th>
                  <th><span>T.C</span></th>
                  <th><span>Parcialidad</span></th>
                  <th><span>Saldo Anterior</span></th>
                  <th><span>Saldo Aplicado</span></th>
                  <th><span>Saldo Insoluto</span></th>
                </tr>
            </thead>
            <tbody>
              <t t-set="monto_pago" t-value="0"/>
              <tr t-foreach="o.complemento()" t-as="inv">
                <t t-set="monto_pago" t-value="monto_pago+float(inv['monto'])" />
                <td><span t-field="o.l10n_mx_edi_cfdi_uuid"/></td>
                <td><span t-esc="inv['serie']"/></td>
                <td><span t-esc="inv['folio']"/></td>
                <td><span t-esc="inv['moneda_DR']"/></td>
                <td><span t-field="o.currency_id.rate"/></td>
                <td><span t-esc="inv['num_parcialidad']"/></td>
                <td style="font-size:11pt;">
                  <span>$</span>
                  <span t-esc="'{:,.2f}'.format(float(inv['imp_saldo_ant']))"/>
                </td>
                <td style="font-size:11pt;">
                  <span>$</span>
                  <span t-esc="'{:,.2f}'.format(float(inv['imp_pagado']))"/>
                </td>
                <td style="font-size:11pt;">
                  <span>$</span>
                  <span t-esc="'{:,.2f}'.format(float(inv['imp_saldo_insoluto']))"/>
                </td>
              </tr>
              <tr >
                <th class="tg-s6z2" colspan="2">Monto Pago:</th>
                <td class="tg-s6z2" colspan="2">
                  <span>$</span>
                  <t t-esc="'{:,.2f}'.format(float(monto_pago))" />
                </td>
              </tr>
              <tr>
                <th class="tg-s6z2" colspan="2">Moneda:</th>
                <td class="tg-s6z2" colspan="2"><span t-field="o.currency_id"/></td>
              </tr>
              <tr>
                <th class="tg-s6z2" colspan="2">Fecha Pago:</th>
                <td class="tg-s6z2" colspan="2"><span t-field="o.payment_date"/></td>
              </tr>
            </tbody>
        </table>
        <br/>
        <br/>
        <table class="table table-sm" style="width:100%;">
            <tbody>
              <tr >
                <td colspan="4"><b>Origen: </b> <br /><span t-field="o.name"/></td>
                <td colspan="2"><strong>Número Operación: </strong> <span t-esc="pago.get('num_operacion')"/></td>
                <td colspan="6"><strong>Importe con letra: </strong> <t t-esc="o._mount_to_text(monto_pago)" /></td>
              </tr>
            </tbody>
        </table>
        <hr/>
        <t t-if="o.l10n_mx_edi_cfdi_uuid">
          <div class="row" id="complement">
              <div class="barcode col-3">
                  <t t-set="sello" t-value="xml.get('Sello', 'No identificado')[-8:]"/>
                  <img alt="Barcode" t-att-src="'/report/barcode/?type=QR&amp;value=%s' % quote_plus(                             'https://verificacfdi.facturaelectronica.sat.gob.mx/default.aspx?' + keep_query(                                 re=o.l10n_mx_edi_cfdi_supplier_rfc, rr=o.l10n_mx_edi_cfdi_customer_rfc,                                 tt=0, id=o.l10n_mx_edi_cfdi_uuid)                                 + '&amp;fe=%s' % quote_plus(sello, 'utf-8', 'strict', '=/').replace('%2B', '+'))"/>
              </div>
              <div class="complement-details col-9">
                  <div class="digital-stamp">
                      <span>Sello digital del emisor</span>
                  </div>
                  <div class="digital-stamp-content">
                      <span t-esc="xml.get('Sello', 'No identificado')"/>
                  </div>
                  <div class="digital-stamp">
                      <span>Sello digital SAT</span>
                  </div>
                  <div class="digital-stamp-content">
                      <span t-esc="tfd.get('SelloSAT', 'No identificado')"/>
                  </div>
                  <div class="digital-stamp">
                      <span>Complemento de cadena original de certificación digital SAT</span>
                  </div>
                  <div class="digital-stamp-content">
                      <span class="nowrap" t-esc="tfd_original_string"/>
                  </div>
                  <div t-if="xml.Emisor.xpath('cfdi:ExpedidoEn', namespaces=xml.nsmap)" class="digital-stamp">
                      <span>Emitido desde</span>
                  </div>
                  <div t-if="xml.Emisor.xpath('cfdi:ExpedidoEn', namespaces=xml.nsmap)" class="digital-stamp-content">
                      <span t-esc="xml.get('LugarExpedicion', 'No identificado')"/>
                  </div>
                  <div class="digital-stamp">
                      <span>Información extra</span>
                  </div>
                  <div class="digital-stamp-content">
                      <span>Certificado de emisor:</span> <span t-esc="xml.get('NoCertificado')"/>
                      <span> | Certificado SAT:</span> <span t-esc="tfd.get('NoCertificadoSAT')"/>
                      <span> | Lugar de expedición:</span> <span t-esc="xml.get('LugarExpedicion')"/>
                      <span> | Régimen fiscal:</span><span t-esc="xml.Emisor.get('RegimenFiscal', '')"/>
                      <span> | Fecha de emisión:</span> <span t-esc="xml.get('Fecha', '').replace('T', ' ')"/>
                      <span> | Fecha de certificación:</span> <span t-esc="tfd.get('FechaTimbrado', '').replace('T', ' ')"/>
                      <span> | Folio fiscal:</span> <span t-esc="tfd.get('UUID')"/>
                  </div>
                  <div class="digital-stamp-content text-center">
                      <strong>Este documento es una representación impresa de un CFDI</strong>
                  </div>
              </div>
          </div>
        </t>
      </div>
      <!-- </t> -->
    </xpath>
  </template>
  <template id="web_external_layout_standard_header" inherit_id="web.external_layout_standard">
    <xpath expr="//div[@class='row']" position="replace">
      <!-- <div t-attf-class="header o_company_#{company.id}_layout"> -->
<!--         <t t-set="o" t-value="o.with_context(lang=lang)"/>
        <t t-set="xml" t-value="o.l10n_mx_edi_get_xml_etree()"/> -->
      <div class="row">
        <div class="col-md-4" style="text-align: center;">
          <img t-if="company.logo" t-att-src="image_data_uri(company.logo)" style="max-height: 200px;" alt="Logo"/>
        </div>
        <div class="col-md-4" style="text-align: center;">
          <h3><strong>WNI MEXICO S.A DE S.V:</strong></h3>
          WME051219G52<br/>
          General de Ley Personas Morales<br/>
          Francisco Pimentel No.98<br/>
          San Rafael,<br/>
          Ciudad de México, México CP:06470<br/>
        </div>
        <div class="col-md-4" style="text-align: center;">
          <h4><strong>Recibo Electrónico de Pagos:</strong></h4>
          <h3><span t-field="o.name"/></h3>
          <strong>Folio Fiscal:</strong><br/>
          <span t-field="o.l10n_mx_edi_cfdi_uuid"/><br/>
          <strong>Fecha Emisión: </strong><br/>
          <strong>Fecha Certificación: </strong><br/>
          <strong>Expedido en: </strong><span t-esc="xml.get('LugarExpedicion')"/><br/>
        </div>
      </div>
      <!-- </div> -->
    </xpath>
  </template>
</odoo>